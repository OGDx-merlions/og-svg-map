{"version":3,"sources":["og-svg-map.es6.js"],"names":["Polymer","is","behaviors","IronResizableBehavior","listeners","properties","width","type","String","value","height","observer","contextPaneProportion","Number","isUpstreamVisible","Boolean","isMidstreamVisible","isDownstreamVisible","isPredictiveVisible","attached","contextPaneOpen","d3","Px","svg","select","dims","$","map","querySelector","getBoundingClientRect","zoomControl","zoom","extent","x","y","scaleExtent","translateExtent","on","e","attr","event","transform","scale","split","replace","parseFloat","factor","mapZoomArea","style","call","_addContextualListeners","toggleContextPane","currHeightNum","cpMinHeightPercentage","mapHeightPercentage","newMapHeight","Math","ceil","contextPaneMinHeight","defaultHeight","contextPaneMaxHeight","closeContextPane","invalidateSize","_showAll","selector","querySelectorAll","forEach","elt","display","_hideAll","_toggleGroup","_stateName","_selector","_pressedCls","undefined","_toggleUpstream","_toggleMidstream","_toggleDownstream","_togglePredictive","_compute","_adjustFilterVerticalMargin","newHeight","oldHeight","_onIronResize","_zoomIn","scaleBy","transition","duration","_zoomOut","listen","_gotoDefaultLocation","zoomIdentity","translate","_openContextPane","fire","contextFragment","currentTarget","classList"],"mappings":"aAAA,CAAC,UAAW,CACVA,QAAQ,CAENC,GAAI,YAFE,CAINC,UAAW,CAACF,QAAQG,qBAAT,CAJL,CAMNC,UAAW,CACT,cAAe,eADN,CANL,CAUNC,WAAY,CACV;;;;SAKAC,MAAO,CACLC,KAAMC,MADD,CAELC,MAAO,MAFF,CANG,CAUV;;;;QAKAC,OAAQ,CACNH,KAAMC,MADA,CAENC,MAAO,OAFD,CAGNE,SAAU,6BAHJ,CAfE,CAoBV;;;;SAKAC,sBAAuB,CACrBL,KAAMM,MADe,CAErBJ,MAAO,IAFc,CAzBb,CA6BVK,kBAAmB,CACjBP,KAAMQ,OADW,CAEjBN,MAAO,IAFU,CA7BT,CAiCVO,mBAAoB,CAClBT,KAAMQ,OADY,CAElBN,MAAO,IAFW,CAjCV,CAqCVQ,oBAAqB,CACnBV,KAAMQ,OADa,CAEnBN,MAAO,IAFY,CArCX,CAyCVS,oBAAqB,CACnBX,KAAMQ,OADa,CAEnBN,MAAO,IAFY,CAzCX,CAVN,CAyDNU,QAzDM,oBAyDK,gBACT,KAAKC,eAAL,CAAuB,KAAvB,CACA,GAAMC,IAAKC,GAAGD,EAAd,CACA,KAAKE,GAAL,CAAYF,GAAGG,MAAH,CAAU,UAAV,CAAZ,CACA,GAAMC,MAAO,KAAKC,CAAL,CAAOC,GAAP,CAAWC,aAAX,CAAyB,KAAzB,EAAgCC,qBAAhC,EAAb,CACA,KAAKC,WAAL,CAAmBT,GAAGU,IAAH,GAChBC,MADgB,CACT,CAAC,CAAC,CAACP,KAAKQ,CAAP,CAAU,CAACR,KAAKS,CAAhB,CAAD,CAAqB,CAACT,KAAKQ,CAAN,CAASR,KAAKS,CAAd,CAArB,CADS,EAEhBC,WAFgB,CAEJ,CAAC,CAAD,CAAI,CAAJ,CAFI,EAGhBC,eAHgB,CAGA,CAAC,CAAC,CAACX,KAAKQ,CAAP,CAAU,CAACR,KAAKS,CAAhB,CAAD,CAAqB,CAACT,KAAKQ,CAAN,CAASR,KAAKS,CAAL,CAAO,CAAhB,CAArB,CAHA,EAIhBG,EAJgB,CAIb,MAJa,CAIL,SAACC,CAAD,CAAO,CACjB,MAAKf,GAAL,CAASgB,IAAT,CAAc,WAAd,CAA2BlB,GAAGmB,KAAH,CAASC,SAApC,EACA,GAAIC,OAAQ,MAAKnB,GAAL,CAASgB,IAAT,CAAc,WAAd,EAA2BI,KAA3B,CAAiC,QAAjC,EAA2C,CAA3C,EAA8CC,OAA9C,CAAsD,GAAtD,CAA2D,EAA3D,CAAZ,CACAF,MAAQG,WAAWH,KAAX,CAAR,CACA,GAAMI,QAASJ,OAAS,CAAT,CAAa,CAAb,CAAkB,CAACA,MAAM,CAAP,EAAU,EAA3C,CACA,MAAKZ,WAAL,CAAiBM,eAAjB,CAAiC,CAAC,CAAC,CAACX,KAAKQ,CAAP,CAAU,CAACR,KAAKS,CAAhB,CAAD,CAAqB,CAACT,KAAKQ,CAAL,CAASa,MAAV,CAAkBrB,KAAKS,CAAL,CAAS,CAA3B,CAArB,CAAjC,CACH,CAVkB,CAAnB,CAWA,KAAKa,WAAL,CAAmB,KAAKxB,GAAL,CAChBgB,IADgB,CACX,MADW,CACH,MADG,EAEhBA,IAFgB,CAEX,gBAFW,CAEO,KAFP,EAGhBA,IAHgB,CAGX,OAHW,CAGF,MAHE,EAIhBA,IAJgB,CAIX,QAJW,CAID,MAJC,EAKhBS,KALgB,CAKV,QALU,CAKA,MALA,EAMhBC,IANgB,CAMX,KAAKnB,WANM,CAAnB,CAOA,KAAKoB,uBAAL,EACD,CAjFK,CAmFNC,iBAnFM,6BAmFc,CAClB,GAAMC,eAAgB,KAAK1C,MAAL,CAAYkC,OAAZ,CAAoB,KAApB,CAA2B,EAA3B,CAAtB,CACA,GAAMS,uBAAwB,KAAKzC,qBAAnC,CACA,GAAM0C,qBAAuB,EAAID,qBAAjC,CACA,GAAG,CAAC,KAAKjC,eAAT,CAA0B,CACxB,GAAMmC,cAAeC,KAAKC,IAAL,CAAUL,cAAgBE,mBAA1B,CAArB,CACA,KAAK5C,MAAL,CAAc,KAAKA,MAAL,CAAYkC,OAAZ,CAAoBQ,aAApB,CAAmCG,YAAnC,CAAd,CACA,KAAKG,oBAAL,CAA4BF,KAAKC,IAAL,CAAUL,cAAgBC,qBAA1B,CAA5B,CACA,KAAKjC,eAAL,CAAuB,IACxB,CALD,IAKO,CACL,KAAKV,MAAL,CAAc,KAAKiD,aAAnB,CACA,KAAKD,oBAAL,CAA4B,CAA5B,CACA,KAAKE,oBAAL,CAA4B,CAA5B,CACA,KAAKxC,eAAL,CAAuB,KACxB,CACF,CAlGK,CAoGNyC,gBApGM,4BAoGa,CACjB,GAAG,KAAKzC,eAAR,CAAyB,CACvB,KAAK+B,iBAAL,EACD,CACF,CAxGK,CA0GNW,cA1GM,0BA0GW,CACf,KAAKpC,CAAL,CAAOC,GAAP,CAAWmC,cAAX,EACD,CA5GK,CA6GNC,QA7GM,mBA6GGC,QA7GH,CA6Ga,CACjB,KAAKC,gBAAL,CAAsBD,QAAtB,EAAgCE,OAAhC,CAAwC,SAACC,GAAD,CAAS,CAC/CA,IAAInB,KAAJ,CAAUoB,OAAV,CAAoB,OACrB,CAFD,CAGD,CAjHK,CAkHNC,QAlHM,mBAkHGL,QAlHH,CAkHa,CACjB,KAAKC,gBAAL,CAAsBD,QAAtB,EAAgCE,OAAhC,CAAwC,SAACC,GAAD,CAAS,CAC/CA,IAAInB,KAAJ,CAAUoB,OAAV,CAAoB,MACrB,CAFD,CAGD,CAtHK,CAuHNE,YAvHM,uBAuHOC,UAvHP,CAuHmBC,SAvHnB,CAuH8BC,WAvH9B,CAuH2C,CAC/C,GAAG,KAAKF,UAAL,CAAH,CAAqB,CACnB,KAAKF,QAAL,CAAcG,SAAd,EACA,KAAKC,WAAL,EAAoB,SACrB,CAHD,IAGO,CACL,KAAKV,QAAL,CAAcS,SAAd,EACA,KAAKC,WAAL,EAAoBC,SACrB,CACD,KAAKH,UAAL,EAAmB,CAAC,KAAKA,UAAL,CACrB,CAhIK,CAiINI,eAjIM,2BAiIY,CAChB,KAAKL,YAAL,CAAkB,mBAAlB,CACE,WADF,CACe,oBADf,CAED,CApIK,CAqINM,gBArIM,4BAqIa,CACjB,KAAKN,YAAL,CAAkB,oBAAlB,CACE,YADF,CACgB,qBADhB,CAED,CAxIK,CAyINO,iBAzIM,6BAyIc,CAClB,KAAKP,YAAL,CAAkB,qBAAlB,CACE,aADF,CACiB,sBADjB,CAED,CA5IK,CA6INQ,iBA7IM,6BA6Ic,CAClB,KAAKR,YAAL,CAAkB,qBAAlB,CACE,aADF,CACiB,sBADjB,CAED,CAhJK,CAiJNS,QAjJM,mBAiJG3D,eAjJH,CAiJoB,CACxB,MAAO,CAACA,eACT,CAnJK,CAoJN4D,2BApJM,sCAoJsBC,SApJtB,CAoJiCC,SApJjC,CAoJ4C,CAChD,GAAG,CAACA,SAAJ,CAAe,CACb,KAAKvB,aAAL,CAAqBsB,SACtB,CACF,CAxJK,CAyJNE,aAzJM,yBAyJU,CAAE,CAzJZ,CA0JNC,OA1JM,mBA0JI,CACR,KAAKtD,WAAL,CAAiBuD,OAAjB,CACE,KAAKtC,WAAL,CAAiBuC,UAAjB,GAA8BC,QAA9B,CAAuC,GAAvC,CADF,CAC+C,GAD/C,CAED,CA7JK,CA8JNC,QA9JM,oBA8JK,CACT,KAAK1D,WAAL,CAAiBuD,OAAjB,CACE,KAAKtC,WAAL,CAAiBuC,UAAjB,GAA8BC,QAA9B,CAAuC,GAAvC,CADF,CAC+C,EAAI,GADnD,CAED,CAjKK,CAkKNrC,uBAlKM,mCAkKoB,iBACxB,KAAKe,gBAAL,CAAsB,aAAtB,EAAqCC,OAArC,CAA6C,SAACC,GAAD,CAAS,CACpD,OAAKsB,MAAL,CAAYtB,GAAZ,CAAiB,KAAjB,CAAwB,kBAAxB,CACD,CAFD,CAGD,CAtKK,CAuKNuB,oBAvKM,gCAuKiB,CACrB,KAAK3C,WAAL,CAAiBuC,UAAjB,GACGC,QADH,CACY,GADZ,EAEGtC,IAFH,CAEQ,KAAKnB,WAAL,CAAiBW,SAFzB,CAGInB,GAAGD,EAAH,CAAMsE,YAAN,CAAmBC,SAAnB,CAA6B,CAA7B,CAAgC,CAAhC,EAAmClD,KAAnC,CAAyC,CAAzC,CAHJ,CAID,CA5KK,CA6KN;;;;;;;;MASAmD,gBAtLM,2BAsLWrD,KAtLX,CAsLkB,CACtB,GAAG,CAAC,KAAKpB,eAAT,CAA0B,CACxB,KAAK+B,iBAAL,EACD,CACD,KAAK2C,IAAL,CAAU,mBAAV,CAA+B,CAC7BtD,MAAOA,KADsB,CAE7BuD,gBAAiBvD,MAAMwD,aAFM,CAG7BC,UAAWzD,MAAMwD,aAAN,CAAoBC,SAHF,CAA/B,CAKD,CA/LK,CAAR,CAiMD,CAlMD","file":"og-svg-map.js","sourcesContent":["(function() {\n  Polymer({\n\n    is: 'og-svg-map', \n\n    behaviors: [Polymer.IronResizableBehavior],\n\n    listeners: {\n      'iron-resize': '_onIronResize'\n    },\n\n    properties: {\n      /**\n       * Component width\n       * \n       * @type {String}\n       */\n      width: {\n        type: String,\n        value: '75vw'\n      },\n      /**\n      * Component Height\n      * \n      * @type {String}\n      */\n      height: {\n        type: String,\n        value: '500px',\n        observer: '_adjustFilterVerticalMargin'\n      },\n      /**\n       * Proportion of contextual pane to the whole window\n       * Must be less than 1.\n       * @type {Number}\n       */\n      contextPaneProportion: {\n        type: Number,\n        value: 0.35\n      },\n      isUpstreamVisible: {\n        type: Boolean,\n        value: true\n      },\n      isMidstreamVisible: {\n        type: Boolean,\n        value: true\n      },\n      isDownstreamVisible: {\n        type: Boolean,\n        value: true\n      },\n      isPredictiveVisible: {\n        type: Boolean,\n        value: true\n      }\n    },\n\n    attached() {\n      this.contextPaneOpen = false;\n      const d3 = Px.d3;\n      this.svg  = d3.select(\"#map svg\");\n      const dims = this.$.map.querySelector(\"svg\").getBoundingClientRect();\n      this.zoomControl = d3.zoom()\n        .extent([[-dims.x, -dims.y], [dims.x, dims.y]])\n        .scaleExtent([1, 5])\n        .translateExtent([[-dims.x, -dims.y], [dims.x, dims.y*3]])\n        .on(\"zoom\", (e) => {\n          this.svg.attr(\"transform\", d3.event.transform);\n          let scale = this.svg.attr(\"transform\").split(\"scale(\")[1].replace(\")\", \"\");\n          scale = parseFloat(scale);\n          const factor = scale == 1 ? 1 : ((scale-1)*10);\n          this.zoomControl.translateExtent([[-dims.x, -dims.y], [dims.x * factor, dims.y * 3]])\n      });\n      this.mapZoomArea = this.svg\n        .attr(\"fill\", \"none\")\n        .attr(\"pointer-events\", \"all\")\n        .attr(\"width\", \"100%\")\n        .attr(\"height\", \"100%\")\n        .style(\"cursor\", \"grab\")\n        .call(this.zoomControl);\n      this._addContextualListeners();\n    },\n\n    toggleContextPane() {\n      const currHeightNum = this.height.replace(/\\D/g, '');\n      const cpMinHeightPercentage = this.contextPaneProportion;\n      const mapHeightPercentage = (1 - cpMinHeightPercentage);\n      if(!this.contextPaneOpen) {\n        const newMapHeight = Math.ceil(currHeightNum * mapHeightPercentage);\n        this.height = this.height.replace(currHeightNum, newMapHeight);\n        this.contextPaneMinHeight = Math.ceil(currHeightNum * cpMinHeightPercentage);\n        this.contextPaneOpen = true;\n      } else {\n        this.height = this.defaultHeight;\n        this.contextPaneMinHeight = 0;\n        this.contextPaneMaxHeight = 0;\n        this.contextPaneOpen = false;\n      }\n    },\n\n    closeContextPane() {\n      if(this.contextPaneOpen) {\n        this.toggleContextPane();\n      }\n    },\n\n    invalidateSize() {\n      this.$.map.invalidateSize();\n    },\n    _showAll(selector) {\n      this.querySelectorAll(selector).forEach((elt) => {\n        elt.style.display = 'block';\n      });\n    },\n    _hideAll(selector) {\n      this.querySelectorAll(selector).forEach((elt) => {\n        elt.style.display = 'none';\n      });\n    },\n    _toggleGroup(_stateName, _selector, _pressedCls) {\n      if(this[_stateName]) {\n        this._hideAll(_selector);\n        this[_pressedCls] = 'pressed';\n      } else {\n        this._showAll(_selector);\n        this[_pressedCls] = undefined;\n      }\n      this[_stateName] = !this[_stateName];\n    },\n    _toggleUpstream() {\n      this._toggleGroup('isUpstreamVisible', \n        '.upstream', 'upstreamPressedCls');\n    },\n    _toggleMidstream() {\n      this._toggleGroup('isMidstreamVisible', \n        '.midstream', 'midstreamPressedCls');\n    },\n    _toggleDownstream() {\n      this._toggleGroup('isDownstreamVisible', \n        '.downstream', 'downstreamPressedCls');\n    },\n    _togglePredictive() {\n      this._toggleGroup('isPredictiveVisible', \n        '.predictive', 'predictivePressedCls');\n    },\n    _compute(contextPaneOpen) {\n      return !contextPaneOpen;\n    },\n    _adjustFilterVerticalMargin(newHeight, oldHeight) {\n      if(!oldHeight) {\n        this.defaultHeight = newHeight;\n      }\n    },\n    _onIronResize() {},\n    _zoomIn() {\n      this.zoomControl.scaleBy(\n        this.mapZoomArea.transition().duration(500), 1.3);\n    },\n    _zoomOut() {\n      this.zoomControl.scaleBy(\n        this.mapZoomArea.transition().duration(500), 1 / 1.3);\n    },\n    _addContextualListeners() {\n      this.querySelectorAll('.contextual').forEach((elt) => {\n        this.listen(elt, 'tap', '_openContextPane');\n      });\n    },\n    _gotoDefaultLocation() {\n      this.mapZoomArea.transition()\n        .duration(750)\n        .call(this.zoomControl.transform, \n          Px.d3.zoomIdentity.translate(0, 0).scale(1));\n    },\n    /**\n    * Fires event when a class named `contextual` is tapped\n    *\n    *   * {Object} event - Contains the event details\n    *   * {Element} contextFragment - Target on which the tap event occured\n    *   * {Array} classList - Classes on the tapped element\n    *\n    * @event contextual-tapped\n    */\n    _openContextPane(event) {\n      if(!this.contextPaneOpen) {\n        this.toggleContextPane();\n      }\n      this.fire('contextual-tapped', {\n        event: event, \n        contextFragment: event.currentTarget,\n        classList: event.currentTarget.classList\n      });\n    }\n  });\n})();\n"]}